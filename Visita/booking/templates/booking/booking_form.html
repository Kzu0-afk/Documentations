<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Home - Visita Cebu</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<h2>Create Booking</h2>
{% include 'header.html' %}
<body>
    <form method="post" id="booking-form">
        {% csrf_token %}

        <label for="hotel-select">Select Hotel:</label>
        <select id="hotel-select" name="hotel" required>
            <option value="" disabled selected>Select a hotel</option>
            {% for hotel in hotels %}
                <option value="{{ hotel.hotelID }}">{{ hotel.hotelName }}</option>
            {% endfor %}
        </select>

        <label for="room-select">Select Room:</label>
        <select id="room-select" name="room" required>
            <option value="" disabled selected>Select a room</option>
        </select>

        <label for="number_of_guests">Number of Guests:</label>
        {{ form.number_of_guests }}

        <label for="check_in_date">Check-In Date:</label>
        {{ form.check_in_date }}

        <label for="check_out_date">Check-Out Date:</label>
        {{ form.check_out_date }}

        <button type="submit" class="btn btn-success">Submit</button>
    </form>

    <script>
        document.getElementById('hotel-select').addEventListener('change', function () {
    const hotelId = this.value; // Get selected hotel ID

    if (!hotelId) {
        console.error('No hotel selected!');
        return; // Exit if no hotel is selected
    }

    fetch(`/room/hotel/${hotelId}/`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const roomSelect = document.getElementById('room-select');
            roomSelect.innerHTML = '<option value="" disabled selected>Select a room</option>'; // Reset options

            if (data.rooms.length === 0) {
                console.warn('No rooms available for this hotel.');
            }

            data.rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = `Room ${room.roomNumber} - ${room.roomType}`;
                roomSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error fetching rooms:', error);
        });
});
    </script>
</body>
</html>
